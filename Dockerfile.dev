FROM golang:1.23-alpine

# 安装必要的包，包括gcc和musl-dev用于CGO
RUN apk add --no-cache git ca-certificates tzdata curl gcc musl-dev sqlite-dev

# 设置Go代理
ENV GO111MODULE=on \
    GOPROXY=https://goproxy.cn,direct

# 安装Air进行热重载
# 使用稳定版本的Air，避免版本兼容性问题
RUN go install github.com/air-verse/air@v1.61.0

# 设置工作目录
WORKDIR /app/backend

# 复制go模块文件
COPY backend/go.mod backend/go.sum ./

# 下载依赖
RUN go mod download

# 暴露端口
EXPOSE 8080

# 启动Air进行热重载
CMD ["air", "-c", ".air.toml"]