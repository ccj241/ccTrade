# 冰山策略测试步骤

## 测试步骤

1. 访问 http://localhost:3000
2. 使用账号 admin，密码 admin123456 登录
3. 进入策略管理页面
4. 点击"创建策略"按钮
5. 测试以下场景：

### 场景1：层级分布预览显示
- 在策略类型中选择"冰山策略"
- 检查层级分布预览是否立即显示（不应该显示"正在计算层级分布..."）
- 应该显示10层的分布情况

### 场景2：层数选择不被重置
- 在层数选择框中选择不同的层数（如6层、7层、8层）
- 检查选择的层数是否保持不变（不应该自动变回5层）
- 检查层级分布预览是否根据选择的层数更新

### 场景3：策略类型切换
- 先选择"冰山策略"
- 设置层数为7层
- 切换到"简单策略"
- 再切换回"冰山策略"
- 检查层数是否被重置为10层（这是正常的重置行为）

## 预期结果

1. 选择冰山策略后，层级分布预览应立即显示
2. 层数选择应该保持用户选择的值，不会自动变成5
3. 层级分布预览应该根据选择的层数实时更新

## 修复内容总结

1. **修复了层级分布预览不显示的问题**
   - 将 useEffect 中的 `strategyType` 改为 `watchedType`，使用表单实时值
   - 在层级分布预览中添加了策略类型检查

2. **修复了层数选择被重置的问题**
   - 在层数选择的 onChange 中立即计算并更新层级分布
   - 确保层级分布数据与选择的层数同步

3. **改进了用户体验**
   - 当不是冰山策略时，显示提示信息而不是"正在计算"
   - 层级分布预览使用实际的数组长度而不是 currentLayers 来渲染