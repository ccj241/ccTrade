# 层级分布预览测试指南

## 测试步骤

1. 打开浏览器访问 http://localhost:3000/
2. 使用测试账号登录：
   - 用户名：admin
   - 密码：admin123456

3. 进入现货策略页面
4. 点击"创建策略"按钮
5. 在策略类型下拉框中选择"冰山策略"或"慢速冰山"

## 需要验证的功能

### 1. 层数选择功能
- [ ] 默认应该显示10层
- [ ] 点击层数下拉框，应该显示5-10层的选项
- [ ] 选择不同层数后，下拉框应该正确显示当前选择的层数
- [ ] 层数不应该一直卡在5层

### 2. 层级分布预览
- [ ] 选择冰山策略后，应该立即显示层级分布预览
- [ ] 10层时应该显示特定的分布（19%, 17%, 15%...）
- [ ] 其他层数应该显示等差数列分布
- [ ] 切换层数时，预览应该实时更新
- [ ] 每层显示：层数、数量百分比、价格浮动

### 3. 策略类型切换
- [ ] 从简单策略切换到冰山策略，应该显示层级分布相关的字段
- [ ] 从冰山策略切换回简单策略，层级分布应该隐藏
- [ ] 再次切换到冰山策略，层数应该恢复到默认的10层

## 已修复的问题

1. **层数状态管理问题**：
   - 添加了 `currentLayers` 变量，使用表单中的实际值
   - 修复了 `watchedLayers` 的定义位置

2. **层数选择器显示问题**：
   - 修改了 `value` 属性，确保正确显示当前值
   - 添加了 `trigger` 调用，强制更新表单

3. **层级分布初始化**：
   - 添加了 `useEffect`，在策略类型切换时初始化分布数据
   - 确保冰山策略选中时立即计算并显示分布

4. **类型定义问题**：
   - 修复了 `StrategyFormData` 类型，包含所有可能的字段
   - 修复了表单默认值的类型问题

## 调试提示

如果仍有问题，可以：
1. 打开浏览器开发者工具（F12）
2. 查看控制台是否有错误信息
3. 在React DevTools中检查组件状态
4. 检查网络请求是否正常