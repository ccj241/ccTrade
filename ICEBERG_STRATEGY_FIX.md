# 冰山策略前端表单修复说明

## 问题描述
用户反馈在现货策略中点击创建策略，选择冰山策略后，只显示了交易方向和数量两个字段，缺少冰山策略所需的其他参数字段。

## 问题分析
经过代码审查，发现：
1. 冰山策略的表单字段实际上都已经存在（第571-684行）
2. 表单字段的条件渲染逻辑存在问题，导致冰山策略特有字段没有正确显示

## 修复内容

### 1. 修复表单默认值
- 在表单初始化时添加了 `layer_quantities` 和 `layer_price_floats` 的默认值
- 确保表单的 `type` 字段有正确的默认值 'simple'

### 2. 修复策略类型切换逻辑
- 在策略类型选择器的 `onChange` 事件中添加了清除验证错误的逻辑
- 优化了策略类型切换时的数据重置逻辑
- 为冰山策略自动计算和设置层级分布数据

### 3. 修复条件渲染逻辑
- 将条件渲染从 `strategyType` 改为使用 `watchedType`（从表单中监听的值）
- 确保表单值变化时，UI能够实时响应

### 4. 修复表单重置逻辑
- 在打开创建弹窗时完整重置表单数据
- 在关闭弹窗时也进行完整的表单重置

## 冰山策略参数说明

### 基础参数
- **策略名称**：可选，不填则自动生成
- **交易对**：必填，从收藏的交易对中选择
- **策略类型**：选择"冰山策略"或"慢速冰山"
- **交易方向**：买入或卖出
- **总数量**：交易的总数量

### 冰山策略特有参数
- **触发价格**：达到此价格后触发策略
- **层数**：5-10层可选，决定订单分成多少层
- **超时时间**：每层订单的超时时间（分钟），默认5分钟
- **价格浮动步长**：每层之间的价格差异（万分比），默认8

### 策略行为说明
- **冰山策略**：一次性将所有层的订单全部挂上，超时后未完全成交则撤销
- **慢速冰山策略**：一次只挂一层订单，成交或超时后再挂下一层

## 验证步骤
1. 访问 http://localhost:3000
2. 使用 admin/admin123456 登录
3. 进入"现货策略"页面
4. 点击"创建策略"
5. 选择策略类型为"冰山策略"
6. 确认显示了所有冰山策略相关的参数字段：
   - 触发价格
   - 层数选择
   - 超时时间
   - 价格浮动步长
   - 层级分布预览

## 代码变更文件
- `/frontend/src/pages/Strategies.tsx`

## 技术要点
1. React Hook Form 的动态验证 schema 切换
2. Controller 组件的正确使用
3. 表单值的监听和条件渲染
4. 表单重置的完整性